---
- hosts: all
  tasks:
    - name: create basic wsgi.py script
      blockinfile:
        dest: /tmp/wsgi.py
        create: yes
        block: |
          def application(env, start_response):
              start_response('200 OK', [('Content-Type', 'text/html')])
              return ["Hello!"]
        mode: 0777

    - name: apt install curl (to test nginx_status)
      apt:
        pkg: curl
        state: present
        update_cache: yes
      when:
        - ansible_pkg_mgr == 'apt'

    - name: yum install curl (to test nginx_status)
      yum:
        name: curl
        state: present
        update_cache: yes
      when:
        - ansible_pkg_mgr == 'yum'

- hosts: all
  vars:
    - gunicorn_project_dir: "/tmp"
    - gunicorn_wsgi_application: "wsgi:application"
  roles:
    - ScorpionResponse.gunicorn
    - role_under_test
